<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Guida Operativa</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<style>
body { font-family: Arial, sans-serif; display: flex; }
#menu { width: 250px; padding: 10px; border-right: 1px solid #ccc; }
#menu ul { list-style: none; padding: 0; }
#menu ul li { margin: 5px 0; }
#content { padding: 20px; flex: 1; }
.highlight { background: yellow; }
summary { cursor: pointer; font-weight: bold; }
</style>
</head>
<body>

<div id="menu">
  <input type="text" id="searchBox" placeholder="Cerca..." style="width:100%;padding:5px;">
  <ul id="menuList"></ul>
</div>

<div id="content">
  <!-- Esempio struttura -->
  <details class="section" id="sec1">
    <summary>1. Diagnostica di sistema</summary>
    <div class="section-content">
      <p>Connessione remota</p>
      <p>Verifica carico risorse</p>
      <p>Identifica processi pesanti</p>
      <p>Controlla spazio disco</p>
    </div>
  </details>

  <details class="section" id="sec2">
    <summary>2. Diagnostica rete</summary>
    <div class="section-content">
      <p>Verifica stato rete</p>
      <p>Ping test</p>
      <p>Verifica configurazione rete</p>
    </div>
  </details>

  <details class="section" id="sec3">
    <summary>3. Procedura da remoto: Problema stampante</summary>
    <div class="section-content">
      <p>Verifica stato stampante</p>
      <p>Test di stampa</p>
      <p>Verifica configurazione rete</p> <!-- icona mancante aggiunta via script -->
    </div>
  </details>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const menuList = document.getElementById("menuList");
  const searchBox = document.getElementById("searchBox");
  const sections = document.querySelectorAll("details.section");

  sections.forEach(section => {
    const summary = section.querySelector("summary");
    const li = document.createElement("li");
    const a = document.createElement("a");
    a.href = "#" + section.id;
    a.textContent = summary.textContent;
    li.appendChild(a);
    menuList.appendChild(li);
    section.dataset.original = section.querySelector(".section-content").innerHTML;
  });

  searchBox.addEventListener("input", () => {
    const q = searchBox.value.toLowerCase();
    sections.forEach(section => {
      const content = section.dataset.original;
      if (content.toLowerCase().includes(q) || section.querySelector("summary").textContent.toLowerCase().includes(q)) {
        section.style.display = "";
        section.open = q !== "";
        if (q) {
          section.querySelector(".section-content").innerHTML =
            content.replace(new RegExp(`(${q})`, "gi"), `<span class="highlight">$1</span>`);
        } else {
          section.querySelector(".section-content").innerHTML = content;
        }
      } else {
        section.style.display = "none";
      }
    });
  });

  const iconMap = {
    "Connessione remota": "fa-laptop-code",
    "Verifica carico risorse": "fa-microchip",
    "Identifica processi pesanti": "fa-tasks",
    "Controlla spazio disco": "fa-hdd",
    "Verifica stato rete": "fa-network-wired",
    "Ping test": "fa-search",
    "Verifica configurazione rete": "fa-network-wired",
    "Verifica stato stampante": "fa-print",
    "Test di stampa": "fa-print"
  };

  const iconColors = {
    diagnostica: "#0078d7",
    rete: "#28a745",
    sicurezza: "#dc3545",
    aggiornamento: "#ffc107"
  };

  const categoryMap = {
    "fa-microchip": "diagnostica",
    "fa-tasks": "diagnostica",
    "fa-hdd": "diagnostica",
    "fa-network-wired": "rete",
    "fa-search": "rete",
    "fa-print": "rete"
  };

  document.querySelectorAll(".section-content").forEach(content => {
    let html = content.innerHTML;
    Object.entries(iconMap).forEach(([text, icon]) => {
      const regex = new RegExp(`(${text})`, "g");
      const color = iconColors[categoryMap[icon]] || "#555";
      html = html.replace(regex, `<i class="fas ${icon}" style="color:${color}"></i> $1`);
    });
    content.innerHTML = html;
  });

  document.querySelectorAll("details.section summary").forEach(summary => {
    const text = summary.textContent.trim();
    let iconKey = Object.keys(iconMap).find(k => text.includes(k));
    if (!iconKey) {
      if (text.toLowerCase().includes("stampante")) iconKey = "Verifica stato stampante";
      else if (text.toLowerCase().includes("rete")) iconKey = "Verifica stato rete";
      else if (text.toLowerCase().includes("diagnostica")) iconKey = "Verifica carico risorse";
    }
    if (iconKey) {
      const icon = iconMap[iconKey];
      const color = iconColors[categoryMap[icon]] || "#555";
      summary.innerHTML = `<i class="fas ${icon}" style="color:${color};margin-right:6px"></i>` + summary.textContent;
    }
  });

  document.querySelectorAll("#menuList a, details.section summary").forEach(el => {
    el.addEventListener("click", () => {
      searchBox.value = "";
      sections.forEach(section => {
        section.style.display = "";
        section.querySelector(".section-content").innerHTML = section.dataset.original;
      });
    });
  });
});
</script>

</body>
</html>
